# בניית סוכן AI למערכת ERP
## סדנת Google ADK ב-Anti-Gravity IDE

---

## מה נבנה היום?

סוכן חכם שמדבר עם מערכת ERP ויודע:
- לשלוף מידע ("מי הלקוחות שחייבים לנו כסף?")
- להוסיף נתונים ("תוסיף לקוח חדש בשם אבי כהן")
- לזהות בעיות ("יש הזמנות באיחור?")

**הכל בלי לכתוב קוד!** פשוט מדברים עם Anti-Gravity והוא בונה את הסוכן בשבילנו.

---

## לפני שמתחילים - מה צריך להכין

### 1. חשבון Google
צריך חשבון Google רגיל (Gmail)

### 2. Python 3.10 ומעלה
ADK דורש Python 3.10 או גרסה חדשה יותר. לבדיקה:
```bash
python3 --version
```

### 2.1 התקנת ADK (אם לא משתמשים ב-Anti-Gravity)
```bash
pip install google-adk
```

### 3. מפתח Gemini API (חשוב!)

השתמשו במפתח ה-API שיצרתם בשיחת ההכנה לסדנה.

> **תזכורת:** המפתח נראה כמו `AIzaSy...` ונמצא ב-[Google AI Studio](https://aistudio.google.com/) תחת **Get API Key**.

> **חשוב:** בלי המפתח הזה הסוכן לא יוכל לענות לשאלות!

### 4. פרטי מערכת ה-ERP לסדנה
```
כתובת API: https://priority-erp-mock.fly.dev/api
מפתח API: priority-adk-workshop-2026
תיעוד (OpenAPI): https://priority-erp-mock.fly.dev/openapi.yaml
```

---

## שלב 1: פתיחת פרויקט חדש

1. היכנסו ל-Anti-Gravity IDE
2. לחצו **New Project**
3. בחרו **ADK Agent** (או Agent Template)
4. תנו שם: `erp-assistant`

---

## שלב 2: הגדרת מפתח ה-API

### פרומפט 1 - יצירת קובץ הגדרות

כתבו בצ'אט של Anti-Gravity:

> צור קובץ .env עם ההגדרות הבאות:
> ```
> GOOGLE_API_KEY=המפתח_שלי_מגוגל
> GOOGLE_GENAI_USE_VERTEXAI=FALSE
> ```

**החליפו** את `המפתח_שלי_מגוגל` במפתח שקיבלתם מ-Google AI Studio!

---

## שלב 3: בניית הכלים לסוכן

הסוכן צריך "כלים" כדי לדבר עם מערכת ה-ERP.

### פרומפט 2 - כלי לקריאת לקוחות

> צור קובץ tools.py עם פונקציה שמתחברת ל-API של מערכת ERP.
>
> פרטי ההתחברות:
> - URL: https://priority-erp-mock.fly.dev/api
> - API Key: priority-adk-workshop-2026 (בהדר X-API-Key)
>
> הפונקציה הראשונה: get_customers - מחזירה רשימת לקוחות מהנתיב /CUSTOMERS

---

### פרומפט 3 - הוספת עוד כלים

> תוסיף לקובץ tools.py את הפונקציות הבאות:
>
> קריאה:
> 1. get_open_orders - מחזיר הזמנות פתוחות מ-/ORDERS עם פילטר ORDSTATUS eq 'Open'
> 2. get_overdue_invoices - מחזיר חשבוניות באיחור מ-/AINVOICES עם פילטר IVSTATUS eq 'Overdue'
> 3. get_low_stock_products - מחזיר מוצרים עם מלאי נמוך מ-/LOGPART
>
> יצירה ועדכון:
> 4. create_customer - יוצר לקוח חדש בנתיב /CUSTOMERS עם POST
> 5. update_customer - מעדכן לקוח קיים עם PATCH (טלפון, אימייל, סטטוס)
> 6. update_order_status - מעדכן סטטוס הזמנה עם PATCH
>
> **טיפ:** לפרמטרים אופציונליים השתמשו ב-`Optional[str]` מ-typing

---

### פרומפט 4 - כלי לקריאת התיעוד (חשוב!)

זה הכלי שמאפשר לסוכן ללמוד לבד:

> תוסיף פונקציה get_api_documentation שמחזירה את תיעוד ה-API.
>
> היא צריכה לקרוא את הקובץ מהכתובת:
> https://priority-erp-mock.fly.dev/openapi.yaml
>
> ככה הסוכן יוכל לקרוא את התיעוד וללמוד לבד איך לעבוד עם ה-API

---

## שלב 4: יצירת הסוכן

### פרומפט 5 - קובץ אתחול (חשוב!)

> צור קובץ __init__.py ריק בתיקיית הפרויקט

זה קובץ טכני ש-ADK צריך כדי לזהות את הפרויקט כסוכן.

### פרומפט 6 - הגדרת הסוכן

> צור קובץ agent.py עם סוכן ADK.
>
> השתמש ב-LlmAgent מ-google.adk.agents עם:
> - model: gemini-3-flash-preview
> - name: erp_assistant
> - הכלים מ-tools.py (שים לב: ייבוא יחסי עם נקודה - `from .tools import ...`)
>
> ההוראות לסוכן (instruction):
> - אתה עוזר למערכת ERP תעשייתית
> - ענה תמיד בעברית
> - עזור עם לקוחות, הזמנות, מלאי וחשבוניות
> - התרע על בעיות כמו חובות ומלאי נמוך

---

## שלב 5: הרצת הסוכן

### פרומפט 7 - הרצה

> איך מריצים את הסוכן?

**פקודות הרצה:**

| פקודה | מה זה עושה |
|-------|------------|
| `adk web .` | פותח ממשק גרפי בדפדפן (מומלץ!) |
| `adk run .` | הרצה בשורת פקודה |

> **שימו לב:** הנקודה (`.`) אומרת "הפרויקט הנוכחי"

**הממשק הגרפי** נפתח בכתובת: http://localhost:8000

### איך להשתמש בממשק:
1. פתחו את הדפדפן בכתובת http://localhost:8000
2. בצד שמאל למעלה, בחרו את הסוכן `erp-assistant` מהרשימה הנפתחת
3. כתבו שאלה בתיבת הטקסט למטה ולחצו Enter
4. הסוכן יענה ותוכלו לראות את הכלים שהוא משתמש בהם

---

## שלב 6: בדיקות

ברגע שהסוכן רץ, נסו לשאול אותו:

| מה לשאול | מה אמור לקרות |
|----------|---------------|
| "מי הלקוחות שלנו?" | מציג רשימת לקוחות |
| "יש חשבוניות באיחור?" | מציג חשבוניות לא משולמות |
| "אילו מוצרים במלאי נמוך?" | מציג מוצרים עם מלאי נמוך |
| "כמה הזמנות פתוחות יש?" | סופר ומציג הזמנות פתוחות |

---

## שלב 7: בניית ממשק React לסוכן

עכשיו נבנה אפליקציית React שמתחברת לסוכן - ככה תוכלו לשלב את הסוכן באפליקציה שלכם!

### פרומפט 8 - יצירת פרויקט React

> צור תיקיית frontend עם פרויקט React (Vite).
>
> הפרויקט צריך:
> - package.json עם react, react-dom ו-vite
> - vite.config.js עם proxy ל-localhost:8000 (שרת ADK)
> - index.html עם תמיכה בעברית (RTL)

### פרומפט 9 - קומפוננטת צ'אט

> צור קומפוננטת App.jsx עם ממשק צ'אט לסוכן ADK.
>
> הממשק צריך:
> - יצירת session ב-/apps/erp-assistant/users/{user}/sessions
> - שליחת הודעות ב-POST ל-/run_sse עם SSE streaming
> - הצגת הודעות משתמש וסוכן בסגנון צ'אט
> - אינדיקציה כשהסוכן חושב (typing indicator)
> - כפתור "שיחה חדשה"
> - תמיכה בעברית

### פרומפט 10 - עיצוב CSS

> צור קובץ styles.css עם עיצוב מודרני לצ'אט.
>
> העיצוב צריך:
> - רקע gradient יפה
> - בועות הודעות עגולות
> - הודעות משתמש בצד ימין, סוכן בצד שמאל
> - אנימציית typing כשהסוכן חושב
> - תמיכה ב-RTL

### הרצה

```bash
cd frontend
npm install
npm run dev
```

הממשק יפתח בכתובת: http://localhost:3000

> **שימו לב:** שרת ADK חייב לרוץ על פורט 8000 כדי שהממשק יעבוד!

---

## איך הממשק מתחבר לסוכן?

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   React App     │────▶│   ADK Server    │────▶│   Gemini API    │
│   (port 3000)   │◀────│   (port 8000)   │◀────│                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        │                       │
        │ POST /run_sse         │ Tools (get_customers, etc.)
        │ (SSE stream)          │
        ▼                       ▼
   הצגת תשובה              מערכת ERP API
```

### נקודות קצה חשובות של ADK:

| Endpoint | Method | תיאור |
|----------|--------|-------|
| `/apps/{app}/users/{user}/sessions` | POST | יצירת session חדש |
| `/run_sse` | POST | שליחת הודעה וקבלת תשובה (SSE) |
| `/list-apps` | GET | רשימת סוכנים זמינים |

---

## דוגמאות לשאלות לסוכן

### שאילתות מידע (READ)
- "הראה לי את כל הלקוחות הפעילים"
- "כמה הזמנות פתוחות יש לנו?"
- "מי חייב לנו כסף?"
- "מה הסטטוס של הזמנה ORD016?"

### יצירת נתונים (CREATE)
- "תוסיף לקוח חדש: חברת אלפא בע״מ, טלפון 03-1234567"

### עדכון נתונים (UPDATE)
- "עדכן את הסטטוס של הזמנה ORD016 ל-In Progress"
- "עדכן את הטלפון של לקוח C001 ל-03-1111111"
- "שנה את הסטטוס של לקוח C016 ללא פעיל"

### ניתוח AI (שילוב מקורות מידע)
- "תן לי ניתוח עסקי: מי הלקוחות עם הסיכון הגבוה ביותר?"
- "שלב נתונים מחשבוניות באיחור, יתרות חובה, והזמנות פתוחות"
- "תן לי סיכום של המצב הפיננסי עם המלצות"
- "מה הלקוח עם היתרה הכי גבוהה?"

---

## פתרון בעיות נפוצות

### "שגיאת API Key" או "Unauthorized"

> יש לי שגיאת API Key. תבדוק שקובץ .env קיים עם GOOGLE_API_KEY

ודאו שהמפתח מ-Google AI Studio מועתק נכון בקובץ `.env`

### הסוכן לא מתחבר ל-ERP

> הסוכן לא מצליח להתחבר ל-API של ה-ERP. תבדוק את הקוד ב-tools.py

### הסוכן לא עונה בעברית

> תעדכן את ההוראות לסוכן (instruction) שיענה תמיד בעברית

### רוצה להוסיף יכולת חדשה

> תוסיף לסוכן יכולת לעדכן סטטוס של הזמנה דרך PATCH ל-/ORDERS

---

## טיפ מתקדם: הסוכן שלומד לבד

אם הסוכן לא יודע לעשות משהו, בקשו ממנו לקרוא את התיעוד:

> "תקרא את תיעוד ה-API ותגיד לי איך לעשות X"

הסוכן ישתמש בכלי get_api_documentation וילמד לבד!

---

## הישויות במערכת

| מה זה בעברית | שם ב-API | לדוגמה |
|--------------|----------|--------|
| לקוחות | CUSTOMERS | שם, טלפון, יתרה |
| הזמנות | ORDERS | מספר הזמנה, סטטוס, סכום |
| מוצרים | LOGPART | שם מוצר, מחיר, מלאי |
| חשבוניות | AINVOICES | מספר חשבונית, סכום, סטטוס |
| הזמנות עבודה | WORKORDERS | פקודות ייצור |
| עובדים | EMPLOYEES | שם, מחלקה, תפקיד |
| ספקים | SUPPLIERS | פרטי ספקים |

---

## תרגיל סיום

בקשו מהסוכן:

> "תן לי דו״ח בוקר: כמה הזמנות פתוחות, האם יש חשבוניות באיחור, ואילו מוצרים צריך להזמין"

אם הסוכן עונה בצורה מסודרת עם כל המידע - הצלחתם!

---

## סיכום - מה עשינו?

1. ✅ השגנו מפתח Gemini מ-Google AI Studio
2. ✅ יצרנו פרויקט ADK חדש
3. ✅ הגדרנו את המפתח בקובץ .env
4. ✅ בנינו כלים לתקשורת עם ה-ERP
5. ✅ יצרנו סוכן חכם שמשתמש בכלים
6. ✅ הרצנו ובדקנו עם adk web
7. ✅ בנינו ממשק React משלנו שמתחבר לסוכן

---

## קישורים שימושיים

- [Google AI Studio](https://aistudio.google.com/) - להשגת מפתח Gemini
- [תיעוד ADK](https://google.github.io/adk-docs/) - מדריכים מתקדמים
- [תיעוד ה-API לסדנה](https://priority-erp-mock.fly.dev/openapi.yaml) - OpenAPI spec
- [ממשק ה-ERP](https://priority-erp-mock.fly.dev/) - ממשק גרפי למערכת

---

בהצלחה!
